<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro"  name="robot">

<xacro:include filename="$(find autonav_bot)/model/robot_urdf.xacro" />
<!-- <xacro:include filename="$(find autonav_bot)/model/robot.gazebo" /> -->


<!-- Define base_footprint, fictious reference for base linkW -->
 <link name="base_footprint"> </link>
 <joint name="base_link_joint" type="fixed">
    <parent link="base_footprint"/>
    <child link="base_link"/>
</joint>

<!-- Chassis link of robot -->
   <link name="base_link">
        <visual>
            <geometry>
                <box size="${body_length} ${body_width} ${body_height}"/>
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 ${height}"/>
            <material name="yellow"/>
        </visual> 
        <collision>
            <geometry>
                <box size="${body_length} ${body_width} ${body_height}"/>
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 ${height}"/>
        </collision>
        <xacro:inertia_chassis/>
    </link>

    <!-- Right Wheel -->
    <joint name="right_wheel_joint" type="continuous">
        <parent link="base_link"/>
        <child link="right_wheel_link"/>
        <origin rpy="0 0 0" xyz="${-s1} ${-s3} ${r}"/>
        <axis xyz="0 1 0"/>
        <limit effort="50000" velocity="10"/>
        <dynamics damping="1.0" friction="1.0"/>
    </joint>

    <link name="right_wheel_link"> 
        <visual>
            <origin rpy="1.570795 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder radius="${r}" length="${wheel_width}"/>
            </geometry>
            <material name="black"/>
        </visual>

        <collision>
            <origin rpy="1.570795 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder radius="${r}" length="${wheel_width}"/>
            </geometry>
        </collision>
        <xacro:inertia_wheel/>
    </link>

    <!-- Left Wheel -->
    <joint name="left_wheel_joint" type="continuous">
        <parent link="base_link"/>
        <child link="left_wheel_link"/>
        <origin rpy="0 0 0" xyz="${-s1} ${s3} ${r}"/>
        <axis xyz="0 1 0"/>
        <limit effort="50000" velocity="10"/>
        <dynamics damping="1.0" friction="1.0"/>
    </joint>

    <link name="left_wheel_link"> 
        <visual>
            <origin rpy="1.570795 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder radius="${r}" length="${wheel_width}"/>
            </geometry>
            <material name="black"/>
        </visual>
        <collision>
            <origin rpy="1.570795 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder radius="${r}" length="${wheel_width}"/>
            </geometry>
        </collision>
        <xacro:inertia_wheel/>
    </link>

    <!-- Caster Wheel -->
    
    <joint name="caster_joint" type="fixed">
        <parent link="base_link"/>
        <child link="caster_link"/>
        <origin rpy="0 0 0" xyz="${s2} 0 ${r}"/>
    </joint>
    <link name="caster_link">
        <visual>
            <origin rpy="1.570795 0 0" xyz="0 0 0"/>
            <geometry>
                <sphere radius="${r}"/>
            </geometry>
            <material name="gray"/>
        </visual>
        <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <sphere radius="${r}"/>
            </geometry>
        </collision>
        <xacro:inertia_caster/>
    </link>

    <!-- ROS2 Control Plugins and Definitions -->

    <ros2_control name="RobotHardware" type="system">

        <hardware>
            <plugin>gz_ros2_control/GazeboSystem</plugin>
        </hardware>

        <joint name="right_wheel_joint">
            <command_interface name="velocity">
                <param name="min">-10</param>
                <param name="max">10</param>
            </command_interface>
            <state_interface name="velocity"/>
            <state_interface name="position"/>
        </joint>

        <joint name="left_wheel_joint">
            <command_interface name="velocity">
                <param name="min">-10</param>
                <param name="max">10</param>
            </command_interface>
            <state_interface name="velocity"/>
            <state_interface name="position"/>
        </joint>
    </ros2_control>

</robot>    